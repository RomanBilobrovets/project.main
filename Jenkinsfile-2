#!/usr/bin/env groovy

pipeline { 
    agent any
    environment {
        ANS_PATH = "/var/lib/jenkins/workspace/jenkinsfile-2/ansible"
        ANS_KEY = credentials("ansible_key")
    }
    stages {
        stage('Deploy') {
            steps { 
                sh 'ansible --version'
                sh 'ls'
                sh 'pwd' 
                sh 'ls ansible'
                // sh 'echo ${ANS_KEY} > ./ansible/ansible_roles.pem'sss
                // sh 'chmod 400 ./ansible/ansible_roles.pem'
                sh 'cd ansible'
                // sh 'ssh-keygen -R server1'
                sh 'echo "$USER"'
                sh 'whoami'
                sh 'cat /var/lib/jenkins/workspace/jenkinsfile-2/ansible/hosts'
                sh 'export ANSIBLE_HOST_KEY_CHECKING=False'
                sh 'ansible-playbook -i ${ANS_PATH}/hosts ${ANS_PATH}/playbook3.yml'
                // sh ('ansible-playbook -vvvvv -i environments/teal_${ENVIRONMENT} playbooks/yourplaybook.yml -e  --vault-password-file ./.vault_pass.txt')
                }
            }
        }
    }