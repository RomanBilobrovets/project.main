#!/usr/bin/env groovy

pipeline { 
    agent any
    environment {
        ANS_PATH = "/var/lib/jenkins/workspace/Docker/Jenkinsfile-Docker"
        ANS_KEY = credentials("ansible_key")
    }
    stages {
        stage('Build and Push Image') {
            steps { 
                sh 'aws ecr get-login-password --region eu-central-1 | docker login --username AWS --password-stdin 519637832355.dkr.ecr.eu-central-1.amazonaws.com'
                sh 'docker build -t your_repository_name .'
                sh 'docker tag your_repository_name:latest 519637832355.dkr.ecr.eu-central-1.amazonaws.com/your_repository_name:latest'
                sh 'docker push 519637832355.dkr.ecr.eu-central-1.amazonaws.com/your_repository_name:latest'
                sh 'docker tag'
                sh 'docker push'
                sh 'cd docker'
                sh 'docker run -p 49160:8080 -d roman/node-web-app'
            }
                
        }
        }

}